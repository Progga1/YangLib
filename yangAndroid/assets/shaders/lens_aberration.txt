#ANDROID precision mediump float;

const vec2 lensCenter = vec2(0.5,0.5);
const vec2 coeffBlue = vec2(1.014, 0.0);
const vec2 coeffRed = vec2(0.996, 0.0-0.004);
const vec2 coeffGreen = vec2(1.0, 0.0);

uniform sampler2D texSampler;
uniform vec2 scale;
uniform vec2 scaleToLens;
uniform vec4 lensParameters;
varying vec2 texCoord;


vec2 HmdWarp(vec2 in01, vec2 in02)
{
  vec2 theta = (in01 - lensCenter) * scaleToLens;
  float rSq = theta.x * theta.x + theta.y * theta.y;
  vec2 theta1 = theta

                  * (in02.x + in02.y * rSq)

                  * (lensParameters.x +
                     lensParameters.y * rSq +
                     lensParameters.z * rSq * rSq +
                     lensParameters.w * rSq * rSq * rSq);

  theta1 = (scale * theta1) + lensCenter;

 // theta1.x = (theta1.x - ((lensCenter.x)));



  return theta1;
}

void main()
{
	  vec2 newPos = texCoord;
	  vec2 tcRed;
	  vec2 tcGreen;
	  vec2 tcBlue;


	  tcBlue = HmdWarp(texCoord, coeffBlue);
      tcRed = HmdWarp(texCoord, coeffRed);
	  tcGreen = HmdWarp(texCoord, coeffGreen);
	
	    gl_FragColor.r = texture2D(texSampler, tcRed).r;
	    gl_FragColor.g = texture2D(texSampler, tcGreen).g;
	    gl_FragColor.b = texture2D(texSampler, tcBlue).b;
		gl_FragColor.a = 1.0;
}